<?php
$_helper = $this->helper('catalog/output');
$_product = $this->getProduct();

$page_url = urlencode(Mage::registry('current_product')->getProductUrl());
$image_url = urlencode($this->helper('catalog/image')->init($_product, 'image'));
$product_name = urlencode($_helper->productAttribute($_product, $_product->getName(), 'name'));
$product_descr = urlencode($this->htmlEscape($_product->getData('description')));

// $facebook = 'http://www.facebook.com/dialog/feed?api_key=679916502073648&amp;display=popup&amp;link='.$page_url.'&amp;picture='.$image_url.'&amp;name='.$product_name.'&amp;caption='.$product_descr.'&amp;description='.$product_name.'&amp;redirect_uri='.$page_url;

$facebook = 'http://www.facebook.com/sharer.php?s=100&amp;p[title]='.$product_name.'&amp;p[summary]='.$product_descr.'&amp;p[url]='.$page_url.'&amp;p[images][0]='.$image_url;
$pinterest = '//pinterest.com/pin/create/button/?media='.$image_url.'&description='.$product_name.'&url='.$page_url;
$twitter = 'http://twitter.com/share?via=PromOutfitters&text='.$product_name.'&url='.$page_url;

$google = 'http://plus.google.com/share?url='.$page_url;
   ?>
<div class="jcarousel slideshow">
    <div class="controls">
        <a class="slider__button jcarousel-prev prev" href="#">Prev</a>
        <a class="slider__button jcarousel-next next" href="#">Next</a>
        <div class="slider__button cycle-caption"></div>
        <div class="slider__button jcarousel-pagination"></div>
    </div>
    <div class="socials">
        <?php $_wishlistSubmitUrl = $this->helper('wishlist')->getAddUrl($_product); ?>
        <?php if ($this->helper('wishlist')->isAllow()) : ?>
            <a href="<?php echo $_wishlistSubmitUrl ?>" class="icon_tooltip like" title="Add to Love List" onclick="productAddToCartForm.submitLight(this, this.href); return false;">Like</a>            
        <?php endif; ?>
        <a href="<?php echo $facebook; ?>" class="icon_tooltip facebbok" title="Share on Facebook">Facebook</a>
        <a href="<?php echo $pinterest; ?>" class="icon_tooltip pinterest" title="Pin on Pinterest"data-pin-do="buttonPin" data-pin-config="none">Pinterest</a>
        <a href="//wanelo.com" class="icon_tooltip symbaloo" title="Post to Wanelo" data-price="$378.00" data-image="<?php echo $image_url ?>" data-title="<?php echo $product_name?>" data-url="<?php echo $page_url ?>">Wanelo</a>
        <a href="<?php echo $twitter; ?>" class="icon_tooltip twitter" title="Tweet this">Twitter</a>
        <a href="<?php echo $google; ?>" class="icon_tooltip google" title="Share on Google+">G+</a>
        <?php //if ($this->helper('catalog/product')->canEmailToFriend()): ?>
            <a href="<?php echo $this->helper('catalog/product')->getEmailToFriendUrl($_product) ?>" class="mail" title="">Mail</a>
        <?php //endif; ?>
    </div>
    <div class="slideshow__list">
    <?php foreach ($this->getGalleryImages() as $_image): ?>
        <div class="image">            
            <img src='<?php echo $this->helper('catalog/image')->init($this->getProduct(), 'thumbnail', $_image->getFile())->keepAspectRatio(TRUE)->keepFrame(FALSE)->resize(475); ?>'>
        </div>
    <?php endforeach; ?>
    </div>
</div>
<script type="text/javascript">
    (function(){
        var slider_width,
            image = jQuery('.slideshow img'),
            slider = jQuery('.jcarousel'),
            slider_img = jQuery('.jcarousel .image'),
            controls = jQuery('.slideshow .controls'),
            cycle = jQuery('.cycle-caption'),
            slider_list = jQuery('.jcarousel-pagination');

// PDP Slider
        jQuery( window ).resize(function() {
            slider_width = jQuery( slider ).width();
            calc_image(slider_width);
        });
        
        jQuery('.jcarousel')
        .on('jcarousel:create jcarousel:reload', function() {
            var element = jQuery(this),
                width = element.innerWidth(),
                slide_count = element.jcarousel("items").length,
                visible_slider = 1;
                calc_image(width);
                cycle.html(visible_slider + "/" + slide_count);

        })
        .on('jcarousel:animateend', function(event, carousel) {
            var element = jQuery(this),
                slide_count = element.jcarousel("items").length,
                visible_slider = slider_list.find('.active').index() + 1;
                cycle.html(visible_slider + "/" + slide_count);
        })
        .jcarousel({
            list: '.slideshow__list',
            items: '.image',
            wrap: 'circular'
        });

        jQuery('.jcarousel-prev').jcarouselControl({
            target: '-=1'
        });

        jQuery('.jcarousel-next').jcarouselControl({
            target: '+=1'
        });

        jQuery('.jcarousel-pagination')
        .on('jcarouselpagination:active', 'a', function() {
            jQuery(this).addClass('active');
        })
        .on('jcarouselpagination:inactive', 'a', function() {
            jQuery(this).removeClass('active');
        })
        .jcarouselPagination({
            perPage: 1,
            item: function(page) {
                return '<a href="#' + page + '">' + page + '</a>';
            }
        });
        
        function calc_image(width) {
            if (width > 640) {
                width = width / 2;
            }

            jQuery(slider_img).each(function(index) {
                jQuery(this).css('width', width + 'px');
            });

            controls.css({
                'left' :   width - 42 + 'px'
            });
        }
//Tooltips
    Tipped.create('.icon_tooltip');
    })();
</script>